---
### Application Gateway
application_gateway_autoscale_configuration:
  min_capacity: 1
  max_capacity: 10
application_gateway_backend_settings:
  connexusenergy:
    http_setting:
      cookie_based_affinity: "Enabled"
      affinity_cookie_name: "ARRAffinity"
application_gateway_frontend_settings:
  "443":
    protocol: Https
    port: 443
    require_sni: true
application_gateway_name: gateway
application_gateway_name_override:
application_gateway_routing_rules:
  "connexusenergy":
    backend_address_pool: connexusenergy
    backend_http_settings: connexusenergy
    http_listener: "443"
    priority: 110
    require_sni: true
application_gateway_subnet: default
application_gateway_ssl_configuration:
  ssl_certificate_name: website
  ssl_secret_name: "Wildcard-Connexusenergy-Com"
application_gateway_virtual_network: web
### App Service
app_service_app_settings:
  connexusenergy:
    WEBSITES_ENABLE_APP_SERVICE_STORAGE: true
    MYSQL_USER: connexusenergy_user_2024
app_service_auto_scale_profile:
  default:
    capacity:
      minimum: 2
      maximum: 30
      default: 2
    rules:
      - metric_trigger:
          operator: GreaterThan
          metric_name: "CpuPercentage"
          statistic: Average
          threshold: 50
          time_aggregation: Average
          time_grain: PT1M
          time_window: PT1M
        scale_action:
          cooldown: PT3M
          direction: Increase
          value: 66
          type: PercentChangeCount
      - metric_trigger:
          operator: LessThan
          metric_name: "CpuPercentage"
          statistic: Average
          threshold: 33
          time_aggregation: Average
          time_grain: PT1M
          time_window: PT1M
        scale_action:
          cooldown: PT3M
          direction: Decrease
          value: 1
          type: ChangeCount
app_service_mysql_password_secret_name: connexusenergy-user-2024-db-password
app_service_client_certificate_mode:
  connexusenergy: "Optional"
app_service_hostnames:
  connexusenergy.com:
    webapp_name: connexusenergy
app_service_key_vault_certificates:
  connexusenergy.com: Wildcard-Connexusenergy-Com
app_service_ip_restriction: {}
app_service_name: website
app_service_name_override:
app_service_site_config:
  connexusenergy:
    always_on: "true"
    api_definition_url:
    api_management_api_id:
    app_command_line:
    auto_heal_action_type:
    auto_heal_minimum_process_execution_time:
    auto_heal_trigger_requests_count:
    auto_heal_trigger_requests_interval:
    auto_heal_trigger_slow_request_count:
    auto_heal_trigger_slow_request_interval:
    auto_heal_trigger_slow_request_time_taken:
    auto_heal_trigger_status_code_count:
    auto_heal_trigger_status_code_interval:
    auto_heal_trigger_status_code_range:
    cors_allowed_origins:
    cors_support_credentials: "false"
    default_documents:
    detailed_error_messages: true
    docker_image_name: cnx-website:20250426
    docker_registry_password:
    docker_registry_url: https://cnxbuildcusregistry.azurecr.io
    docker_registry_username:
    dotnet_version:
    failed_request_tracing: true
    ftps_state: "FtpsOnly"
    go_version:
    health_check_eviction_time_in_min: 3
    health_check_path: "/"
    http2_enabled: "false"
    http_logging_retention_in_days: 7
    http_logging_retention_in_mb: 35
    ip_restriction_default_action: "Allow"
    java_server:
    java_server_version:
    java_version:
    load_balancing_mode: "LeastRequests"
    node_version:
    php_version:
    python_version:
    ruby_version:
    use_32_bit_worker: "true"
    vnet_route_all_enabled: "true"
    websockets_enabled: "false"
    worker_count: "1"
app_service_sku: P0v3
app_service_storage_mount_path:
  assets: /var/www/html/application/files
app_service_virtual_network_subnet:
  connexusenergy:
    virtual_network: web
    subnet: AppServiceSubnet
app_service_webapps:
- connexusenergy
### key Vault
key_vault_name: web-01
key_vault_name_override:
key_vault_public_network_access_enabled: true
key_vault_roles:
  - "Key Vault Secrets Officer"
  - "Key Vault Certificates Officer"
key_vault_purge_protection: true
key_vault_retention_days: 90
key_vault_secret_keys:
  - "cnx-cert-web"
key_vault_secrets:
  cnx-cert-web: 'replace me by the real certificate on portal'
key_vault_sku: "standard"
key_vault_use_precreated_secrets: false
### MySQL
mysql_administrator_login: CNXWebDBAdmin
mysql_backup_retention_days: 7
mysql_name: webdb
mysql_name_override:
mysql_databases:
  connex-db-live:
    charset: utf8
    collation: utf8_unicode_ci
mysql_server_configuration:
  innodb_buffer_pool_size: 4294967296
  require_secure_transport: "OFF"
mysql_sku: GP_Standard_D4ads_v5
mysql_zone: "3"
### Private DNS
private_dns_zones:
- "privatelink.azurewebsites.net"
- "privatelink.mysql.database.azure.com"
- "privatelink.vaultcore.azure.net"
- "privatelink.file.core.windows.net"
private_dns_links:
  privatelink.azurewebsites.net:
  - db
  - web
  privatelink.mysql.database.azure.com:
  - db
  privatelink.vaultcore.azure.net:
  - web
  privatelink.file.core.windows.net:
  - web
### Private Endpoints
app_service_private_endpoints:
  connexusenergy:
    name: connexusenergy
    name_override:
    private_dns_zone: privatelink.azurewebsites.net
    private_service_connection:
      name: connexusenergy-pe
      subresource_names:
      - sites
      is_manual_connection: false
key_vault_private_endpoints:
  web-01:
    name: web-01
    name_override:
    private_dns_zone: privatelink.vaultcore.azure.net
    private_service_connection:
      name: web-01-pe
      subresource_names:
      - vault
      is_manual_connection: false
mysql_private_endpoints:
  webdb:
    name: webdb
    name_override:
    private_dns_zone: privatelink.mysql.database.azure.com
    private_service_connection:
      name: webdb-pe
      subresource_names:
      - mysqlServer
      is_manual_connection: false
storage_account_private_endpoints:
  website:
    name: website
    name_override:
    private_dns_zone: privatelink.file.core.windows.net
    private_service_connection:
      name: website-pe
      subresource_names:
      - file
      is_manual_connection: false
private_endpoints_virtual_network: web
private_endpoints_subnet: PrivateEndpointSubnet
### Public IP
public_ip_name: pip
public_ip_name_override:
### Storage Account
storage_account_bypass:
  - "AzureServices"
  - "Logging"
  - "Metrics"
storage_account_default_action: "Deny"
storage_account_kind: StorageV2
storage_account_ip_rules: []
storage_account_name: website
storage_account_name_override:
storage_account_virtual_networks_allowed:
  - web
storage_account_public_network_access_enabled: true
storage_account_shares:
  assets:
    name: assets
    enabled_protocol: "SMB"
    quota: 100
    acl: {}
storage_account_tier: "Standard"
### Resource Groups
key_vault_resource_group_name: keyvault
key_vault_resource_group_name_override:
resource_group_name: website
resource_group_name_override:
### Virtual Network
virtual_networks:
  db:
    name: db
    name_override:
    subnet_delegations: {}
    subnet_private_service_policies_enabled:
      cnxweb-subnet-db: true
    subnet_services: {}
  web:
    name: web
    name_override:
    subnet_delegations:
      AppServiceSubnet:
        delegation:
          service_name: "Microsoft.Web/serverFarms"
          service_actions:
          - "Microsoft.Network/virtualNetworks/subnets/action"
    subnet_private_service_policies_enabled:
      AppServiceSubnet: true
      default: true
      PrivateEndpointSubnet: true
    subnet_services: {}
vnet_peerings:
  Backend2FrontEnd:
    network: "db"
    remote_network: "web"
    allow_remote_network_access: true
  Frontend2Backend:
    network: "web"
    remote_network: "db"
    allow_remote_network_access: true
### Common tags
tags: {}
